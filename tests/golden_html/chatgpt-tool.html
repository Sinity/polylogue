
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Golden ChatGPT Tool + Attachments</title>
    <style>
      :root {
        --bg: #ffffff;
        --fg: #222222;
        --accent: #2563eb;
        --border: #3b82f644;
      }
      * { box-sizing: border-box; }
      body {
        background: var(--bg);
        color: var(--fg);
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0;
        line-height: 1.6;
      }
      header {
        position: sticky;
        top: 0;
        z-index: 10;
        backdrop-filter: blur(6px);
        background: color-mix(in srgb, var(--bg) 88%, transparent);
        border-bottom: 1px solid var(--border);
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      main {
        max-width: 980px;
        margin: 0 auto;
        padding: 1.5rem;
      }
      h1 { margin: 0; font-size: 1.5rem; }
      a { color: var(--accent); }
      .pill {
        border: 1px solid var(--border);
        padding: 0.35rem 0.6rem;
        border-radius: 999px;
        font-size: 0.9rem;
      }
      .muted { opacity: 0.8; font-size: 0.85rem; }
      .toolbar { display: flex; gap: 0.75rem; align-items: center; }
      .search-input {
        flex: 1;
        padding: 0.45rem 0.75rem;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: color-mix(in srgb, var(--bg) 96%, #00000008);
        color: var(--fg);
      }
      .sidebar-input {
        width: 100%;
        padding: 0.4rem 0.6rem;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: color-mix(in srgb, var(--bg) 96%, #00000008);
        color: var(--fg);
        margin: 0.4rem 0 0.75rem;
      }
      .layout { display: grid; grid-template-columns: 260px 1fr; gap: 1.25rem; align-items: start; }
      .card {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1rem;
        background: color-mix(in srgb, var(--bg) 96%, #00000006);
      }
      @media (max-width: 860px) {
        header { flex-wrap: wrap; }
        .layout { grid-template-columns: 1fr; }
      }
      .metadata table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 0.5rem;
      }
      .metadata th, .metadata td {
        border: 1px solid var(--border);
        padding: 0.35rem 0.5rem;
        text-align: left;
        font-size: 0.9rem;
      }
      .toc ul { list-style: none; padding-left: 0; margin: 0; }
      .toc li { margin: 0.2rem 0; }
      .toc a { text-decoration: none; }
      .toc a:hover { text-decoration: underline; }
      .attachments { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.75rem; }
      .attachment {
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 0.6rem 0.75rem;
        background: color-mix(in srgb, var(--bg) 94%, #00000008);
      }
      .attachment .att-meta { display: flex; gap: 0.5rem; align-items: baseline; flex-wrap: wrap; }
      .attachment .att-name { font-weight: 600; }
      .attachment .att-sub { font-size: 0.85rem; opacity: 0.8; }
      .attachment img {
        width: 100%;
        max-height: 160px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid var(--border);
        margin-top: 0.5rem;
      }
      .lightbox {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: color-mix(in srgb, #000 75%, transparent);
        z-index: 30;
        padding: 1.25rem;
      }
      .lightbox[open] { display: flex; }
      .lightbox-card {
        max-width: 1100px;
        width: 100%;
        max-height: 92vh;
        border-radius: 14px;
        border: 1px solid var(--border);
        background: var(--bg);
        overflow: hidden;
        display: grid;
        grid-template-rows: auto 1fr;
      }
      .lightbox-header {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        justify-content: space-between;
        padding: 0.65rem 0.85rem;
        border-bottom: 1px solid var(--border);
      }
      .lightbox-header a { text-decoration: none; }
      .lightbox-body {
        padding: 0.75rem;
        overflow: auto;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .lightbox-body img {
        max-width: 100%;
        max-height: 80vh;
        object-fit: contain;
        border-radius: 10px;
        border: 1px solid var(--border);
      }
      .content blockquote {
        border-left: 4px solid #3b82f6;
        padding-left: 1rem;
        margin-left: 0;
        background: #3b82f611;
      }
      details.callout {
        margin: 1rem 0;
        border-left: 4px solid #3b82f6;
        padding-left: 1rem;
        background: #3b82f611;
      }
      details.callout summary {
        cursor: pointer;
        font-weight: 600;
        list-style: none;
      }
      details.callout summary::-webkit-details-marker { display: none; }
      details.callout summary::before {
        content: 'â–¶';
        display: inline-block;
        margin-right: 0.5rem;
        transform: rotate(0deg);
        transition: transform 0.2s ease;
      }
      details.callout[open] summary::before { transform: rotate(90deg); }
      pre {
        background: #22222211;
        padding: 0.75rem;
        overflow-x: auto;
      }
      code { font-family: "JetBrains Mono", "Fira Code", monospace; }
      h2 { margin-top: 2rem; }
      .hidden { display: none !important; }
      .anchor-btn {
        margin-left: 0.4rem;
        font-size: 0.85rem;
        color: var(--accent);
        text-decoration: none;
        opacity: 0.7;
      }
      .anchor-btn:hover { opacity: 1; }
    </style>
  </head>
  <body>
    <header>
      <div class="pill">Golden ChatGPT Tool + Attachments</div>
      <input class="search-input" id="client-search" type="search" placeholder="Filter text (press / to focus)" />
      <div class="toolbar"><span class="pill" id="match-count"></span></div>
    </header>
    <main>
      <div class="layout">
        <div class="card toc">
          <h3>Contents</h3>
          <ul id="toc"></ul>
          
        </div>
        <div>
          <div class="card metadata">
            <table>
              <tbody>
                
                <tr>
                  <th>attachmentPolicy</th>
                  <td>{&#34;charThreshold&#34;: 4000, &#34;extractedCount&#34;: 2, &#34;lineThreshold&#34;: 40, &#34;previewLines&#34;: 5, &#34;routing&#34;: {&#34;routed&#34;: 0, &#34;skipped&#34;: 4}}</td>
                </tr>
                
                <tr>
                  <th>attachment_bytes</th>
                  <td>296</td>
                </tr>
                
                <tr>
                  <th>attachments</th>
                  <td>0</td>
                </tr>
                
                <tr>
                  <th>attachmentsDir</th>
                  <td>&lt;path&gt;</td>
                </tr>
                
                <tr>
                  <th>collapseThreshold</th>
                  <td>10</td>
                </tr>
                
                <tr>
                  <th>contentHash</th>
                  <td>8973bd2c8438ac0e240f20676ba42406f38bb7880298f3e8e4e70b0f9c1f2e55</td>
                </tr>
                
                <tr>
                  <th>currentBranch</th>
                  <td>branch-000</td>
                </tr>
                
                <tr>
                  <th>dirty</th>
                  <td>False</td>
                </tr>
                
                <tr>
                  <th>html</th>
                  <td>False</td>
                </tr>
                
                <tr>
                  <th>htmlPath</th>
                  <td>None</td>
                </tr>
                
                <tr>
                  <th>lastImported</th>
                  <td>2000-01-01T00:00:00Z</td>
                </tr>
                
                <tr>
                  <th>lastUpdated</th>
                  <td>1700000004</td>
                </tr>
                
                <tr>
                  <th>outputPath</th>
                  <td>&lt;path&gt;</td>
                </tr>
                
                <tr>
                  <th>polylogue</th>
                  <td>{&#34;contentHash&#34;: &#34;8973bd2c8438ac0e240f20676ba42406f38bb7880298f3e8e4e70b0f9c1f2e55&#34;, &#34;conversationId&#34;: &#34;golden-chatgpt-tool-1&#34;, &#34;lastUpdated&#34;: &#34;1700000004&#34;, &#34;provider&#34;: &#34;chatgpt&#34;, &#34;slug&#34;: &#34;golden-chatgpt-tool-attachments&#34;, &#34;title&#34;: &#34;Golden ChatGPT Tool + Attachments&#34;}</td>
                </tr>
                
                <tr>
                  <th>slug</th>
                  <td>golden-chatgpt-tool-attachments</td>
                </tr>
                
                <tr>
                  <th>sourceExportPath</th>
                  <td>tests/fixtures/golden/chatgpt_tool</td>
                </tr>
                
                <tr>
                  <th>title</th>
                  <td>Golden ChatGPT Tool + Attachments</td>
                </tr>
                
                <tr>
                  <th>token_count</th>
                  <td>28</td>
                </tr>
                
                <tr>
                  <th>tokens</th>
                  <td>28</td>
                </tr>
                
                <tr>
                  <th>word_count</th>
                  <td>28</td>
                </tr>
                
                <tr>
                  <th>words</th>
                  <td>28</td>
                </tr>
                
              </tbody>
            </table>
          </div>
          <div class="content" id="content"><h2 id="model">Model</h2>
<p>Done.</p>
</div>
        </div>
      </div>
    </main>
    <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Attachment preview">
      <div class="lightbox-card">
        <div class="lightbox-header">
          <div>
            <strong id="lightbox-title"></strong>
            <span class="muted" id="lightbox-hint"></span>
          </div>
          <div class="toolbar">
            <a id="lightbox-open" href="#" target="_blank" class="pill">open</a>
            <a href="#" id="lightbox-close" class="pill">close</a>
          </div>
        </div>
        <div class="lightbox-body">
          <img id="lightbox-img" alt="" />
        </div>
      </div>
    </div>
    <script>
      const tocEl = document.getElementById('toc');
      const headings = document.querySelectorAll('#content h1, #content h2, #content h3');
      headings.forEach(h => {
        if (!h.id) return;
        const clone = h.cloneNode(true);
        clone.querySelectorAll('.anchor-btn').forEach(n => n.remove());
        const headingText = (clone.textContent || '').trim();
        const anchor = document.createElement('a');
        anchor.href = `#${h.id}`;
        anchor.textContent = 'ðŸ”—';
        anchor.className = 'anchor-btn';
        anchor.title = 'Copy link';
        anchor.addEventListener('click', evt => {
          evt.preventDefault();
          const url = `${window.location.origin}${window.location.pathname}#${h.id}`;
          navigator.clipboard?.writeText(url).catch(() => {});
          window.location.hash = h.id;
        });
        h.appendChild(anchor);
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = `#${h.id}`;
        a.textContent = headingText || h.id;
        li.appendChild(a);
        tocEl.appendChild(li);
      });
      const searchInput = document.getElementById('client-search');
      const content = document.getElementById('content');
      const blocks = Array.from(content.querySelectorAll('p, li, blockquote, details'));
      const matchCount = document.getElementById('match-count');
      function applyFilter(term) {
        const q = term.trim().toLowerCase();
        let matches = 0;
        blocks.forEach(el => {
          const text = el.textContent.toLowerCase();
          const hit = q && text.includes(q);
          el.classList.toggle('hidden', q && !hit);
          if (hit) matches += 1;
        });
        matchCount.textContent = q ? `${matches} match(es)` : '';
      }
      searchInput.addEventListener('input', (e) => applyFilter(e.target.value));
      window.addEventListener('keydown', (e) => {
        if (e.key === '/' && document.activeElement !== searchInput) {
          e.preventDefault();
          searchInput.focus();
        }
      });

      // Add copy-link buttons for message anchors (msg-N)
      const msgAnchors = content.querySelectorAll('a[id^="msg-"]');
      msgAnchors.forEach(anchor => {
        const id = anchor.getAttribute('id');
        if (!id) return;
        const btn = document.createElement('a');
        btn.href = `#${id}`;
        btn.textContent = 'ðŸ”—';
        btn.className = 'anchor-btn';
        btn.title = 'Copy link to message';
        btn.addEventListener('click', evt => {
          evt.preventDefault();
          const url = `${window.location.origin}${window.location.pathname}#${id}`;
          navigator.clipboard?.writeText(url).catch(() => {});
          window.location.hash = id;
        });
        anchor.insertAdjacentElement('afterend', btn);
      });

      // Attachments: filter + lightbox previews.
      const attFilter = document.getElementById('att-filter');
      const attCards = Array.from(document.querySelectorAll('.attachment'));
      function applyAttFilter(term) {
        const q = (term || '').trim().toLowerCase();
        for (const card of attCards) {
          const hay = card.getAttribute('data-att') || '';
          card.classList.toggle('hidden', q && !hay.includes(q));
        }
      }
      if (attFilter) attFilter.addEventListener('input', (e) => applyAttFilter(e.target.value));

      const lightbox = document.getElementById('lightbox');
      const lightboxImg = document.getElementById('lightbox-img');
      const lightboxTitle = document.getElementById('lightbox-title');
      const lightboxOpen = document.getElementById('lightbox-open');
      const lightboxHint = document.getElementById('lightbox-hint');
      const lightboxClose = document.getElementById('lightbox-close');

      function closeLightbox() {
        if (!lightbox) return;
        lightbox.removeAttribute('open');
        if (lightboxImg) lightboxImg.src = '';
      }
      function openLightbox(src, name) {
        if (!lightbox) return;
        lightbox.setAttribute('open', 'true');
        if (lightboxImg) lightboxImg.src = src;
        if (lightboxImg) lightboxImg.alt = name || '';
        if (lightboxTitle) lightboxTitle.textContent = name || '';
        if (lightboxHint) lightboxHint.textContent = ' (Esc to close)';
        if (lightboxOpen) lightboxOpen.href = src;
      }
      document.querySelectorAll('.att-preview').forEach(img => {
        img.addEventListener('click', (e) => {
          e.preventDefault();
          const src = img.getAttribute('data-full') || img.getAttribute('src');
          const name = img.getAttribute('data-name') || '';
          openLightbox(src, name);
        });
      });
      if (lightboxClose) lightboxClose.addEventListener('click', (e) => { e.preventDefault(); closeLightbox(); });
      if (lightbox) lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
      window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeLightbox(); });
    </script>
  </body>
</html>